<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Meteograma â€” SÃ£o SebastiÃ£o, SP</title>
<style>
  :root{
    --bg:#0b0f1a; --fg:#e5e7eb; --grid:#1f2937; --muted:#9ca3af;
    --temp:#ef4444; --dew:#f59e0b; --wind:#22d3ee; --gust:#06b6d4; --press:#8b5cf6; --rain:#3b82f6;
  }
  body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Arial}
  .wrap{display:flex; height:80vh; overflow:hidden}
  .labels{width:220px; background:#0d1324; border-right:1px solid var(--grid); position:sticky; left:0; z-index:2}
  .labels .row{height:60px; display:flex; align-items:center; padding:0 12px; border-bottom:1px dashed var(--grid)}
  .grid{flex:1; overflow:auto}
  table{border-collapse:collapse; width:max-content}
  th, td{min-width:48px; height:60px; border-bottom:1px dashed var(--grid); text-align:center; font-size:12px; position:relative}
  thead th{height:32px; color:var(--muted); border-bottom:1px solid var(--grid)}
  .daysep{border-left:2px solid rgba(255,255,255,0.2)}
  .cell-night{background:rgba(17,24,39,0.25)}
  .sky{font-size:16px}
  .temp{color:var(--temp); font-weight:600; display:block}
  .dew{color:var(--dew); opacity:0.9; display:block}
  .windbox{display:flex; flex-direction:column; align-items:center; gap:2px}
  .arrow{width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:10px solid var(--wind); transform-origin:center center}
  .vtxt{color:var(--wind); font-weight:600}
  .gust{color:var(--gust)}
  .press{color:var(--press)}
  .cloud{background:rgba(156,163,175,0.18)}
  .bar{position:absolute; bottom:4px; left:50%; transform:translateX(-50%); width:8px; background:var(--rain); border-radius:3px}
  .tooltip{position:fixed; background:#111827; color:#e5e7eb; border:1px solid #374151; border-radius:6px; padding:8px 10px; font-size:12px; pointer-events:none; z-index:10; display:none}
  .header{display:flex; gap:8px; align-items:center; padding:8px 12px; color:var(--muted)}
</style>
</head>
<body>
<div class="header">Meteograma â€” SÃ£o SebastiÃ£o, SP Â· Fonte: GFS Â· Ãšltima atualizaÃ§Ã£o automÃ¡tica</div>
<div class="wrap">
  <div class="labels">
    <div class="row">Horas</div>
    <div class="row">CÃ©u</div>
    <div class="row">Temperatura<br/><span style="color:var(--muted)">Ponto de orvalho</span></div>
    <div class="row">Vento<br/><span style="color:var(--muted)">Rajadas</span></div>
    <div class="row">PressÃ£o</div>
    <div class="row">Nuvens<br/><span style="color:var(--muted)">Chuva</span></div>
  </div>
  <div class="grid">
    <table id="tbl">
      <thead><tr id="tr-day"></tr><tr id="tr-hour"></tr></thead>
      <tbody>
        <tr id="tr-sky"></tr>
        <tr id="tr-temp"></tr>
        <tr id="tr-wind"></tr>
        <tr id="tr-press"></tr>
        <tr id="tr-cloud"></tr>
      </tbody>
    </table>
  </div>
</div>
<div class="tooltip" id="tip"></div>
<script>
function parseCSV(txt){
  const lines=txt.trim().split(/\r?\n/); const header=lines[0].split(",");
  const rows=lines.slice(1).map(l=>l.split(","));
  const idx=(name)=>header.indexOf(name);
  const num=(v)=>{const n=parseFloat(v); return isNaN(n)?null:n};
  const getn=(name)=>rows.map(r=>num(r[idx(name)]));
  const time=rows.map(r=>r[idx("time")]);
  return {
    time,
    temperature:getn("temperature_2m"),
    dewpoint:getn("dewpoint_2m"),
    precipitation:getn("precipitation"),
    cloudcover:getn("cloudcover"),
    windspeed:getn("windspeed_10m"),
    windgusts:getn("windgusts_10m"),
    winddir:getn("winddirection_10m"),
    pressure:getn("pressure_msl"),
    is_day: rows.map(r=>parseInt(r[idx("is_day")]||"1",10))
  }
}
function skyIcon(isDay, cloud, precip){
  if((precip||0)>=0.2) return isDay? "ðŸŒ§ï¸":"ðŸŒ§ï¸";
  if((cloud||0)>=75) return isDay? "â˜ï¸":"â˜ï¸";
  if((cloud||0)>=40) return isDay? "ðŸŒ¤ï¸":"â˜ï¸";
  return isDay? "â˜€ï¸":"ðŸŒ™";
}
function dayLabel(iso){
  const d=new Date(iso);
  const wd=d.toLocaleDateString('pt-BR',{weekday:'long'});
  const day=d.getDate();
  return wd.charAt(0).toUpperCase()+wd.slice(1)+" "+day;
}
function kmh(ms){ if(ms==null) return null; return Math.round(ms*3.6) }
function fmt(n,unit){ if(n==null) return "-"; return `${Math.round(n*10)/10}${unit}` }
function build(){
  fetch("./data/gfs_sao_sebastiao_hourly.csv").then(r=>r.text()).then(txt=>{
    const d=parseCSV(txt);
    const trDay=document.getElementById("tr-day");
    const trHour=document.getElementById("tr-hour");
    const trSky=document.getElementById("tr-sky");
    const trTemp=document.getElementById("tr-temp");
    const trWind=document.getElementById("tr-wind");
    const trPress=document.getElementById("tr-press");
    const trCloud=document.getElementById("tr-cloud");
    const tip=document.getElementById("tip");

    let prevDay=null;
    for(let i=0;i<d.time.length;i++){
      const iso=d.time[i];
      const curDay=new Date(iso).toDateString();
      const thDay=document.createElement("th");
      const thHour=document.createElement("th");
      const tdSky=document.createElement("td");
      const tdTemp=document.createElement("td");
      const tdWind=document.createElement("td");
      const tdPress=document.createElement("td");
      const tdCloud=document.createElement("td");

      if(prevDay!==curDay){ thDay.textContent=dayLabel(iso); thDay.classList.add("daysep"); }
      else { thDay.textContent=""; }
      prevDay=curDay;

      const hh=new Date(iso).getHours().toString().padStart(2,"0");
      thHour.textContent=hh;
      if(i>0){
        thDay.classList.add("daysep");
        thHour.classList.add("daysep");
        tdSky.classList.add("daysep");
        tdTemp.classList.add("daysep");
        tdWind.classList.add("daysep");
        tdPress.classList.add("daysep");
        tdCloud.classList.add("daysep");
      }

      if(d.is_day[i]===0){
        tdSky.classList.add("cell-night");
        tdTemp.classList.add("cell-night");
        tdWind.classList.add("cell-night");
        tdPress.classList.add("cell-night");
        tdCloud.classList.add("cell-night");
      }

      const icon=skyIcon(d.is_day[i]===1, d.cloudcover[i], d.precipitation[i]);
      const sky=document.createElement("div"); sky.className="sky"; sky.textContent=icon; tdSky.appendChild(sky);

      const t=document.createElement("span"); t.className="temp"; t.textContent=fmt(d.temperature[i],"Â°");
      const td=document.createElement("span"); td.className="dew"; td.textContent=fmt(d.dewpoint[i],"Â°");
      tdTemp.appendChild(t); tdTemp.appendChild(td);

      const windBox=document.createElement("div"); windBox.className="windbox";
      const arrow=document.createElement("div"); arrow.className="arrow"; arrow.style.transform=`rotate(${d.winddir[i]}deg)`;
      const vtxt=document.createElement("div"); vtxt.className="vtxt"; vtxt.textContent=kmh(d.windspeed[i])!=null? kmh(d.windspeed[i])+" km/h":"-";
      const gust=document.createElement("div"); gust.className="gust"; gust.textContent=kmh(d.windgusts[i])!=null? kmh(d.windgusts[i])+" km/h":"-";
      windBox.appendChild(arrow); windBox.appendChild(vtxt); windBox.appendChild(gust); tdWind.appendChild(windBox);

      const press=document.createElement("div"); press.className="press"; press.textContent=d.pressure[i]!=null? Math.round(d.pressure[i])+"":"-";
      tdPress.appendChild(press);

      const cloud=document.createElement("div"); cloud.className="cloud"; cloud.style.width="100%"; cloud.style.height="100%"; cloud.style.opacity=String(Math.min(1,(d.cloudcover[i]||0)/100));
      tdCloud.appendChild(cloud);
      const mm=d.precipitation[i]||0;
      if(mm>0){
        const bar=document.createElement("div"); bar.className="bar";
        const h=Math.min(52, mm*12);
        bar.style.height=h+"px";
        tdCloud.appendChild(bar);
      }

      const showTip=(ev)=>{
        const parts=[];
        parts.push(d.time[i]);
        parts.push("Temp: "+fmt(d.temperature[i],"Â°C")+" Â· Td: "+fmt(d.dewpoint[i],"Â°C"));
        parts.push("Vento: "+fmt(d.windspeed[i]," m/s")+" Â· Raj: "+fmt(d.windgusts[i]," m/s")+" Â· Dir: "+fmt(d.winddir[i],"Â°"));
        parts.push("PressÃ£o: "+fmt(d.pressure[i]," hPa"));
        parts.push("Nuvens: "+fmt(d.cloudcover[i]," %")+" Â· Chuva: "+fmt(d.precipitation[i]," mm/h"));
        tip.innerHTML=parts.join("<br/>");
        tip.style.display="block";
        tip.style.left=(ev.clientX+12)+"px";
        tip.style.top=(ev.clientY+12)+"px";
      };
      const hideTip=()=>{ tip.style.display="none"; };
      [thHour, tdSky, tdTemp, tdWind, tdPress, tdCloud].forEach(el=>{
        el.addEventListener("mousemove", showTip);
        el.addEventListener("mouseleave", hideTip);
      });

      trDay.appendChild(thDay);
      trHour.appendChild(thHour);
      trSky.appendChild(tdSky);
      trTemp.appendChild(tdTemp);
      trWind.appendChild(tdWind);
      trPress.appendChild(tdPress);
      trCloud.appendChild(tdCloud);
    }
  });
}
build();
</script>
</body>
</html>